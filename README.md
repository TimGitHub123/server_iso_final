** –£—á–µ–±–Ω—ã–π —Å—Ç–µ–Ω–¥ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º DE **
–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç:
01. Airflow;
02. S3 MiniO;
03. Spark;
04. Trino;
05. Iceberg;
06. Superset;
07. ClickHouse (2 —à–∞—Ä–¥—ã 2 —Ä–µ–ø–ª–∏–∫–∏, –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ 'c2sh2rep') - –∑–∞ –ø–æ–º–æ—â—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ö–ª–∏–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –î–º–∏—Ç—Ä–∏—é –î–µ–º–µ–Ω—Ç—å–µ–≤—É https://t.me/dementev_tech
08.
09.

** –û–±—Ä–∞—â–∞—é –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥–ª—è Airflow –∏ Superset —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É PosgreSQL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
** –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–∞–∫ —Ç–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ë–î Superset –∏ Airflow –≤ –æ–¥–Ω–æ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–µ PosgreSQL
*** –¢–∞–∫–∂–µ –æ–±—Ä–∞—â–∞—é –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —É Airflow –∏ Redis –≤–∫–ª—é—á–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞–º—è—Ç–∏, —á—Ç–æ–±—ã –∏—Ö —Å–Ω—è—Ç—å —É–¥–∞–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–¥–µ–ª deploy —Å–æ –≤—Å–µ–º–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞–º–∏

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è **
- Docker –∏ Docker Compose
- –û–ó–£ 8 Gb (–º–æ–∂–Ω–æ –¥–∞—Ç—å —Å—Ä–∞–∑—É 10 Gb, Spark –ø–æ—à—É—Å—Ç—Ä–µ–µ –±—É–¥–µ—Ç)
- CPU 4 —è–¥—Ä–∞ (—Ç—É—Ç —Ç–æ–∂–µ –º–æ–∂–Ω–æ –ø–æ–∏–≥—Ä–∞—Ç—å—Å—è)
- HDD 20 Gb
- –°–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ—Ä—Ç—ã: 2182, 8002-8005, 8080-8089, 8124, 8181, 8888, 9001, 9123-9126

### –°–æ—Å—Ç–∞–≤ ClickHouse

- **4√ó ClickHouse Server** (–≤–µ—Ä—Å–∏—è 25.1) ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —É–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞
- **1√ó ZooKeeper** (3.9.3) ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- **1√ó HAProxy** (3.1.7) ‚Äî –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏
- **1 —Ç–∏–ø –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: 2√ó2 (—à–∞—Ä–¥—ã√ó—Ä–µ–ø–ª–∏–∫–∏)

–ó–∞—Ö–æ–¥–∏–º —á–µ—Ä–µ–∑ PUTTY –Ω–∞ –ü–ö —Å Ubuntu
–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º—ã –±—É–¥–µ–º –≤ –ø–∞–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è /home/ubuntu

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, –∫ –ø—Ä–∏–º–µ—Ä—É **springam** (–∏–º—è –∫—Ä–∏—Ç–∏—á–Ω–æ, –∫ –Ω–µ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Airflow
```bash
mkdir springam
```
** –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ –∫–æ–º–∞–Ω–¥–æ–π —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤:
```bash
cd springam
```

** –ß–µ—Ä–µ–∑ WinSCP –≥—Ä—É–∑–∏–º –ø–∞–ø–∫–∏ –∏ —Ñ–∞–π–ª—ã –∏–∑ –∞—Ä—Ö–∏–≤–∞ 04_airflow_trino_superset_clickhhouse.zip –≤–Ω—É—Ç—Ä—å –ø–∞–ø–∫–∏ /home/ubuntu/springam


#–∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Å–æ—á–Ω–∏—Ü—É! (–∏–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º connection timeout - –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –µ—â–µ —Ä–∞–∑ –∫–æ–º–∞–Ω–¥—É sudo docker compose up -d )
sudo docker compose up -d

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

** –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker compose ps
```

** –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞ ClickHouse
```bash
# –ß–µ—Ä–µ–∑ HAProxy (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)
curl "http://default:123456@localhost:8124" -d "SELECT version()"

# –ò–ª–∏ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É–∑–ª—É
curl "http://default:123456@localhost:9123" -d "SELECT version()"
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏

| –ö–ª–∞—Å—Ç–µ—Ä    | –®–∞—Ä–¥—ã | –†–µ–ø–ª–∏–∫–∏ |           –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ     |
|------------|-------|---------|--------------------------|
| `c2sh2rep` |   2   |    2    | –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ |
|------------|-------|---------|--------------------------|

### –ü–æ—Ä—Ç—ã –∏ –¥–æ—Å—Ç—É–ø

| –°–µ—Ä–≤–∏—Å    | HTTP | Native | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                     |
|-----------|------|--------|--------------------------------|
| HAProxy   | 8124 |  9001  | –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ—Å—Ç—É–ø) |
| click1    | 9123 |  8002  | –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏      |
| click2    | 9124 |  8003  | –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏      |
| click3    | 9125 |  8004  | –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏      |
| click4    | 9126 |  8005  | –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏      |
| ZooKeeper |   -  |  2182  | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞           |
|-----------|------|--------|--------------------------------|

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `default`
- **–ü–∞—Ä–æ–ª—å**: 		`1q2w3e4r`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```sql
-- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
SHOW CLUSTERS;
```

IP –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:
|====|==============================================|============|============|=================|
|  ‚Ññ |		–ù–∞–∑–≤–∞–Ω–∏–µ 	|			–ê–¥—Ä–µ—Å			|    login	 |     pass   |       –ë–∞–∑–∞      |
|====|==============================================|============|============|=================|
|  1 |	Airflow			|	http://11.11.1.22:8081/	|   airflow  |  airflow   |                 |
|  2 |	S3 MiniO		|   http://11.11.1.22:9001/	| minioadmin | minioadmin |                 |
|  3 |	Spark UI		|	http://11.11.1.22:8089/	|    		 |   		  |                 |
|  4 |	superset		|	http://11.11.1.22:8088/	|    admin	 | 	admin     |                 |
|  5 |	trino   		|	http://11.11.1.22:8080/ |    admin   |   	      |                 |
|  6 |	spark-iceberg	|	http://11.11.1.22:8888/ |    		 |  	 	  |                 |
|  7 |	rest			|	http://11.11.1.22:8181/	|    		 |   	 	  |                 |
|	 |					|							|    		 |   		  |                 |
|	 |					|							|    		 |   		  |                 |
|	 |					|							|    		 |   		  |                 |
|	 |					|							|    		 |   		  |                 |
|	 |					|							|    		 |   		  |                 |
|	 |					|							|    		 |   		  |                 |
|	 | postgres airflow	|	  11.11.1.22 port 5433  |  airflow   |  airflow   | airflow         |
|	 | postgres_superset|	  11.11.1.22 port 5434  |  superset  |  superset  | superset        |
|	 | postgres-iceberg	|	  11.11.1.22 port 5435	|  iceberg   |  iceberg   | iceberg_catalog |
|	 | bi_postgres  	|	  11.11.1.22 port 5436  |  postgres  |  postgres  | postgres        |
|====|==================|===========================|============|============|=================|

** –î–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**

```bash
docker-compose down && docker-compose build && docker-compose up -d  
```


–ö–æ–º–∞–Ω–¥—ã –¥–ª—è Docker
# –ø–æ–∫–∞–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∫–∞–∂–¥—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º.
sudo docker stats

# –ö–æ–º–∞–Ω–¥–∞ —Å –∏–º–µ–Ω–µ–º, —Å—Ç–∞—Ç—É—Å–æ–º –∏ –ø–æ—Ä—Ç–∞–º–∏
# –§–ª–∞–≥ -a –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–≤–∫–ª—é—á–∞—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
docker ps -a --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"


# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –Ω–∞—Ö–æ–¥—è—Å—å –≤ –ø–∞–ø–∫–µ —Å —Ñ–∞–π–ª–æ–º docker-compose
sudo docker compose down --rmi all --volumes --remove-orphans

# –° –æ—á–∏—Å—Ç–∫–æ–π volumes (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
sudo docker system prune -a --volumes


# –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ç–∏
sudo docker network prune

# –ß—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ (–ø—Ä–æ—Å–º–æ—Ç—Ä –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è)
sudo docker system df
docker system df -v

# –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã
docker container ls -a --filter status=exited
docker images -f dangling=true
docker volume ls -f dangling=true
docker network ls --filter type=custom

# –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ö–≤–æ—Å—Ç–æ–≤ (!!! –ê–∫–∫—É—Ä–∞—Ç–Ω–æ, —É–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π !!!)
sudo docker compose down --rmi all --volumes --remove-orphans
sudo docker system prune -a --volumes -f
sudo docker network prune -f

# –¥–ª—è superset
sudo docker compose --profile init up -d

# 1. –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É docker (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
sudo groupadd docker

# 2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã (–ë–ï–ó –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
newgrp docker